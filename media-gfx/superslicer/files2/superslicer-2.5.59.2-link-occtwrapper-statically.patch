From 53e8068c6c275c0b3cdb4d234149eae48855838a Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx@gmail.com>
Date: Fri, 30 May 2025 17:33:06 +0200
Subject: [PATCH 04/19] 2.5.59.2 link occtwrapper statically

Signed-off-by: Paul Zander <negril.nx@gmail.com>

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 6811673f7..3a89d617e 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -31,7 +31,7 @@ endif()
 add_subdirectory(libslic3r)
 
 if (SLIC3R_ENABLE_FORMAT_STEP)
-    add_subdirectory(occt_wrapper)
+    add_subdirectory(occt_wrapper EXCLUDE_FROM_ALL)
 endif ()
 
 if (SLIC3R_GUI)
diff --git a/src/libslic3r/CMakeLists.txt b/src/libslic3r/CMakeLists.txt
index 570a36f63..1dbc73289 100644
--- a/src/libslic3r/CMakeLists.txt
+++ b/src/libslic3r/CMakeLists.txt
@@ -619,10 +619,7 @@ target_link_libraries(libslic3r
     LibBGCode::bgcode_convert
     )
 
-if (APPLE)
-    # TODO: we need to fix notarization with the separate shared library
-    target_link_libraries(libslic3r OCCTWrapper)
-endif ()
+target_link_libraries(libslic3r OCCTWrapper)
 
 if (TARGET OpenVDB::openvdb)
     target_link_libraries(libslic3r OpenVDB::openvdb)
diff --git a/src/libslic3r/Format/STEP.cpp b/src/libslic3r/Format/STEP.cpp
index 48e9f941d..1eb31d3e0 100644
--- a/src/libslic3r/Format/STEP.cpp
+++ b/src/libslic3r/Format/STEP.cpp
@@ -26,17 +26,13 @@
 
 namespace Slic3r {
 
-#if __APPLE__
 extern "C" bool load_step_internal(const char *path, OCCTResult* res);
-#endif
 
 LoadStepFn get_load_step_fn()
 {
     static LoadStepFn load_step_fn = nullptr;
 
-#ifndef __APPLE__
     constexpr const char* fn_name = "load_step_internal";
-#endif
 
     if (!load_step_fn) {
         boost::filesystem::path libpath = boost::dll::program_location().parent_path();
@@ -58,8 +54,6 @@ LoadStepFn get_load_step_fn()
             FreeLibrary(module);
             throw;
         }
-#elif __APPLE__
-        load_step_fn = &load_step_internal;
 #else
         // first try with system install directory
         if (libpath.filename() == "bin") {
diff --git a/src/occt_wrapper/CMakeLists.txt b/src/occt_wrapper/CMakeLists.txt
index d66a81f77..da16036dc 100644
--- a/src/occt_wrapper/CMakeLists.txt
+++ b/src/occt_wrapper/CMakeLists.txt
@@ -1,12 +1,7 @@
 cmake_minimum_required(VERSION 3.13)
 project(OCCTWrapper)
 
-if (APPLE)
-    # TODO: we need to fix notarization with the separate shared library
-    add_library(OCCTWrapper STATIC OCCTWrapper.cpp)
-else ()
-    add_library(OCCTWrapper MODULE OCCTWrapper.cpp)
-endif ()
+add_library(OCCTWrapper STATIC OCCTWrapper.cpp)
 
 set_target_properties(OCCTWrapper
     PROPERTIES
-- 
2.49.0

