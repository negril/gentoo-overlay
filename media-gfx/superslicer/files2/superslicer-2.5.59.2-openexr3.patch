From 0896daedaa9f46a6016e5d31b8ecb337558b35fa Mon Sep 17 00:00:00 2001
From: Paul Zander <negril.nx@gmail.com>
Date: Fri, 30 May 2025 17:33:06 +0200
Subject: [PATCH 02/19] 2.5.59.2 openexr3

Signed-off-by: Paul Zander <negril.nx@gmail.com>

diff --git a/cmake/modules/FindOpenVDB.cmake b/cmake/modules/FindOpenVDB.cmake
index bcc874570..715638a2c 100644
--- a/cmake/modules/FindOpenVDB.cmake
+++ b/cmake/modules/FindOpenVDB.cmake
@@ -350,6 +350,7 @@ endmacro()
 find_package(TBB ${_quiet} ${_required} COMPONENTS tbb)
 find_package(ZLIB ${_quiet} ${_required})
 find_package(Boost ${_quiet} ${_required} COMPONENTS iostreams system )
+find_package(Imath CONFIG)
 
 # Use GetPrerequisites to see which libraries this OpenVDB lib has linked to
 # which we can query for optional deps. This basically runs ldd/otoll/objdump
@@ -400,7 +401,7 @@ foreach(PREREQUISITE ${_OPENVDB_PREREQUISITE_LIST})
     set(OpenVDB_USES_LOG4CPLUS ON)
   endif()
 
-  string(FIND ${PREREQUISITE} "IlmImf" _HAS_DEP)
+  string(FIND ${PREREQUISITE} "OpenEXR" _HAS_DEP)
   if(NOT ${_HAS_DEP} EQUAL -1)
     set(OpenVDB_USES_ILM ON)
   endif()
@@ -431,11 +432,7 @@ if(OpenVDB_USES_LOG4CPLUS)
   find_package(Log4cplus ${_quiet} ${_required})
 endif()
 
-if(OpenVDB_USES_ILM)
-  find_package(IlmBase ${_quiet} ${_required})
-endif()
-
-if(OpenVDB_USES_EXR)
+if(OpenVDB_USES_ILM OR OpenVDB_USES_EXR)
   find_package(OpenEXR ${_quiet} ${_required})
 endif()
 
@@ -452,6 +449,7 @@ endif()
 set(_OPENVDB_VISIBLE_DEPENDENCIES
   Boost::iostreams
   Boost::system
+  Imath::Imath
 )
 
 set(_OPENVDB_DEFINITIONS)
@@ -461,10 +459,7 @@ endif()
 
 if(OpenVDB_USES_EXR)
   list(APPEND _OPENVDB_VISIBLE_DEPENDENCIES
-    IlmBase::IlmThread
-    IlmBase::Iex
-    IlmBase::Imath
-    OpenEXR::IlmImf
+    OpenEXR::OpenEXR
   )
   list(APPEND _OPENVDB_DEFINITIONS "-DOPENVDB_TOOLS_RAYTRACER_USE_EXR")
 endif()
-- 
2.49.0

